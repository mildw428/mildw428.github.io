---
layout: default
title: 14. 일관성 있는 협력
parent: 오브젝트
---
# 14. 일관성 있는 협력
---

객체는 협력을 위해 존재한다.
객체지향 패러다임의 장점은 설계를 재사용할 수 있다는 것이다.하지만 재사용은 공짜로 얻어지지 않는다. 재사용을 위해서는 객체들의 협력 방식을 일관성 있게 만들어야 한다. 가능하면 유사한 기능을 구현하기 위해 유사한 협력 패턴을 사용하라. 일관성 있는 협력 패턴을 적용하면 여러분의 코드가 이해하기 쉽고 직관적이며 유연해진다는 것이 이번 장의 주제이다.

일관성 있는 설계를 만드는데 가장 훌륭한 조언은 다양한 설계 경험을 익히라는 것이다. 두번째 조언은 널리 알려진 디자인 패턴을 학습하고 변경이라는 문맥 안에서 디자인 패턴을 적용해 보라는 것이다.

- 변하는 개념을 변하지 않는 개념으로부터 분리하라
- 변하는 개념을 캡슐화하라
이 두가지 지침은 훌륭한 구조를 설계하기 위해 따라야 하는 기본적인 원칙이기도 하다.

##### 조건 로직 대 객체 탐색
4장의 할인 조건과 할인 정책의 종류를 판단하는 두 개의 if문이 존재하며 새로운 조건이 필요하면 우리는 if문들에 새로운 else를 추가하게 될 것이다.

객체지향은 조금 다른 접근 방법을 취한다. 조건 로직을 객체 사이의 이동으로 바꾸는 것이다. 이전에 작성한 Movie는 할인 정책이 어떤 종류인지 확인하지 않는다. 단순히 discountPolicy에 필요한 메시지를 전송할 뿐이다.
![[Pasted image 20240602173628.png]]

##### 캡슐화 다시 살펴보기
캡슐화는 클래스의 모든 인스턴스 변수는 private으로 선언해야 하고 오직 해당 클래스의 메서드만 인스턴스 변수에 접근할 수 있어야 한다는 것이다.
캡슐화는 단순히 데이터를 감추는것이 아니며, 소프트웨어 안에서 변할 수 있는 어떤 개념이라도 감추는 것이다.
![[Pasted image 20240602173746.png]]


#### 일관성 있는 기본 정책 구현하기

변경 분리하기
첫번째 단계는 변하는 개념과 변하지 않는 개념을 분리하는 것이다.
![[Pasted image 20240602174132.png]]
시간대별, 요일별, 구견별 방식의 공통점은 각 기본 정책을 구성하는 방식이 유사하다는 점이다.
- 기본 정책은 한 개 이상의 규칙으로 구성된다.
- 하나의 규칙은 적용조건과 단위요금의 조합이다.
![[Pasted image 20240602174443.png]]

따라서 변하지 않는 규칙으로부터 변하는 적용조건을 분리해야한다.

변경 캡슐화하기
여기서 변하지 않는 부분은 규칙, 변하는 것은 조건이다 따라서 규칙으로부터 적용조건을 분리해서 추상화한 후 시간대별, 요일별, 구간방식을 이 추상화의 서브타입으로 만든다.

![[Pasted image 20240602174649.png]]

Feerule은 규칙을 담당하며 Feecondition은 조건을 담당한다

협력 패턴 설계하기
![[Pasted image 20240602174737.png]]
변하지 않는 추상화만 남겨 재사용 가능한 협력 패턴을 선명하게 드러낸다.

![[Pasted image 20240602174803.png]]

규칙의 적용 조건을 만족하는 구간들로 나누는 작업은 이를 잘 알고있는 feeCondition에게 책임을 맡긴다. 이렇게 분리된 통화구간에 단위 요금을 적용해서 요금을 적용하는 계산은 FeeRule이 담담한다.

![[Pasted image 20240602175024.png]]


##### 협력 패턴에 맞추기
이제 고정요금 정책이 남있다.
고정 요금 정책을 어떻게 하면 기존 협력에 맞출 수 있을까? FeeCondition타입을 추가하는 것 뿐이다. 개념적으로 불필요한 FixedFeeCondition클래스를 추가하고 findTimeIntervals메서드의 반환 타입이 List임에도 항상 단 하나의 DateTimeInterval인스턴스를 반환한다는 사실이 조금 걸리지만 개념적 무결성을 무너뜨리는 것보다는 약간의 부조화를 수용하는 편이 더 낫다.
![[Pasted image 20240602175520.png]]


지금까지 살펴본 것 처럼 일관성 있는 협력의 핵심은 변경을 분리하고 캡슐화하는 것이다.
