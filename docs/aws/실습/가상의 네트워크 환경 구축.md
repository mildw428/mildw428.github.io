---
layout: default
title: 가상의 네트워크 환경 구축
parent: 실습
grand_parent: aws
---
# 가상의 네트워크 환경 구축
---

**시나리오**
- OOO 은 AWS 를 접하고 AWS 를 활용하여 회사들에 “**사내 네트워크 구성 및 가상 PC 자원을 제공”**하는 사업을 구상했다.
    
- 해당 아이템을 가지고 회사 A 를 차린 OOO 은 **다양한 요청을 가진 고객사의 네트워크 환경을 알맞게 구축**하여 사업을 유지할 수 있을까..?
    
- **기본정보**
    
    - 가상 PC 제공은 하나의 PC 당 EC2 한 대(private ip 할당)를 제공한다고 가정한다.
    - 네트워크 구성시 기본적으로 private subnet 과 public subnet 을 구분하여 구성한다.
    - Private Subnet 의 외부 통신은 NAT Gateway 를 활용한다.
    - 고객사 요청에 맞게 네트워크 (ex. CIDR / subnet / Connect / VPN) 를 구성한다.
        - 적절한 크기의 VPC 대역을 확보하여 네트워크를 구성한다.
        - 주소범위의 중복을 고려하여 네트워크를 구성한다.
        - 기본적으로 서비스의 가용성 달성을 위한 서브넷 환경을 구성하도록 한다. (최소 2+)
    - 회사 A (본사) 의 네트워크 구성도는 다음과 같다.
    
- **시나리오 1 - 회사 B**
    
    - 회사 B 는 대기업으로 회사 구성원은 2000명 이다.
        - 사업 도메인 특성상 구성원은 최대 4000명으로 제한된다.
    - 회사 B 는 사업 특성상 2개의 지사를 가지고 있습니다. (총 3개 - 본사 / 지사 1 / 지사 2)
        - 각 본사 + 지사별로 다른 Subnet 으로 분리되기를 원합니다.
- **시나리오 2 - 회사 C**
    
    - 회사 C 는 스타트업으로 회사 구성원은 10명이 되지 않는다. (IoT 제품)
        - 사업 도메인 특성상 구성원은 최대 200명으로 제한된다.
    - 기본적인 사내 구성원들의 가상 PC 제공 요청 외로 제품 홍보 홈페이지 제작을 위한 서비스도 VPC 에 올리고자 한다.
        - 기본적인 보안 구성을 맞춰 3-tier 로 subnet 을 분리하여 구성 한다.
            - 참고 : 사내 네트워크 구성도 (public - private - private)
        - 제품 홍보 홈페이지는 외부의 사용자들이 접근할 수 있어야 한다.
            - 해당 제품 홈페이지는 하루 50명 정도 접근하는 사이트이다. (많은 트래픽 X)
- **시나리오 3 - 통합 / 연결**
    
    - 해당 사업을 운영하고 있는 회사 A 는 고객사 요청에 따라 각 회사별 PC 에 접근 하여 유지보수까지 지원하게 되었습니다.
    - 회사 A 의 AWS 네트워크 환경에서 B / C 회사에 접근하여 PC 를 점검할 수 있는 방안에 대해 모색하고 네트워크 구성도로 작성해주세요.
        - ex. VPC Peering / Transit Gateway

**결과**
[캡쳐1] 회사 B 의 네트워크 구성도
![[aws002.drawio.png]]
- ~~B company 192.168.0.0/18~~
- 가용 영역 1:
    - ~~Public 서브넷: 192.168.0.0/21~~
    - Private 서브넷 1: 192.168.8.0/21
    - Private 서브넷 2: 192.168.16.0/21
    - Private 서브넷 3: 192.168.24.0/21
- 가용 영역 2:
    - ~~Public 서브넷: 192.168.32.0/21~~
    - Private 서브넷 1: 192.168.40.0/21
    - Private 서브넷 2: 192.168.48.0/21
    - Private 서브넷 3: 192.168.56.0/21

[캡쳐1] 회사 C 의 네트워크 구성도
![[aws004.drawio.png]]
- ~~C company 192.168.0.0/21~~
- 가용 영역 1:
    - ~~Public 서브넷: 192.168.0.0/24~~
    - Private 서브넷 1: 192.168.4.0/24
    - Private 서브넷 2: 192.168.8.0/24
    - Private 서브넷 3: 192.168.12.0/24
- 가용 영역 2:
    - ~~Public 서브넷: 192.168.16.0/24~~
    - Private 서브넷 1: 192.168.20.0/24
    - Private 서브넷 2: 192.168.24.0/24
    - Private 서브넷 3: 192.168.28.0/24

[캡쳐3] 회사 A/B/C 통합 네트워크 구성도
![[스크린샷 2024-03-24 오후 10.40.37.png]]

---
오답 노트

B기업과 C기업의 Public Subnet을 가용영역당 한개씩뒀는데, 네트워크 장비 추가 여부에 따라 각각의 Private Subnet당 Public Subnet이 1개씩 있는게 조금 더 유연한 구조라고 한다. 또한 CIDR도 3개의 Private Subnet을 수용할 수 있을정도로 블록의 크기를 늘려야한다.

또한 VPC CIDR의 크기에 따라 요금이 더 부과될 줄 알았는데, 그것은 아닌듯 하다. 때문에 `B company 192.168.0.0/18`라고 설정 했던 부분도 최대 크기인 `B company 192.168.0.0/16`으로 잡는것이 좋겠다.

수정
```
B company 192.168.0.0/16
- 가용 영역 1:
    - Public 서브넷 1: 192.168.0.0/21
    - Public 서브넷 2: 192.168.8.0/21
    - Public 서브넷 3: 192.168.16.0/21
    - Private 서브넷 1: 192.168.24.0/21
    - Private 서브넷 2: 192.168.32.0/21
    - Private 서브넷 3: 192.168.40.0/21
- 가용 영역 2:
    - Public 서브넷 4: 192.168.48.0/21
    - Public 서브넷 5: 192.168.56.0/21
    - Public 서브넷 6: 192.168.64.0/21
    - Private 서브넷 4: 192.168.72.0/21
    - Private 서브넷 5: 192.168.80.0/21
    - Private 서브넷 6: 192.168.88.0/21

```

A/B/C 통합구성도에서는 비용을 생각해서 VPC Peering을 사용했는데, 규모가 커질경우 관리상 Transit Gateway를 사용하는것도 좋을 것 같다.