---
layout: default
title: 10. CloudFront
parent: aws
---
# 10. CloudFront
---

cloud front란 CDN, 즉 컨텐츠 전송 네트워크라는 뜻

서로 다른 엣지 로케이션에 미리 캐싱하여 읽기 성능을 높이는 것이다

전세계의 총 216개의 엣지 로케이션이 구성되어 있어 낮은 레이턴시로 접근할 수 있게된다.

컨텐츠가 전체적으로 분산되어 있으므로 DDoS 공격에서 보호 받을 수 있다

버킷에는 CloudFront만 접근할 수 있게 보장하는데, 이를 가능하게하는것은 OAC라 불리는 Origin Access Control로 기존의 OAI를 대체한다.

>OAI (Origin Access Identity)란 CloudFront가 S3에 저장된 Private 객체에 액세스 할 수 있도록 하는 특별한 식별자다.

> OAS
> Origin Access Control + S3 Bucket Policy

### Ingress
CloudFront를 통해 버킷 데이터를 보내는 방법도 가능하다

HTTP 백엔드와 같은 사용자 정의 원본을 쓸수있다????

예시로, 어플리케이션 로드 밸런서나 EC2인스턴스, 또는 S3 웹사이트

CloudFront와 CRR(교차 리전 복제)간의 차이점?

CloudFront는 전세계를 대상으로 한정적 컨텐츠를 사용하고자 할때 사용

교차 리전은 각 리전에 설정이 되어 있어야한다. 즉 전세계를 대상으로 한것이 아니다
그리고 파일은 거의 실시간으로 갱신되고 캐싱되지 않는다.

---

## 어플리케이션 로드밸런서를 원본으로 사용할경우

EC2인스턴스를 통해 HTTP백엔드를 개발한다고 가정

그리고 사용자들이 CloudFront를 통해 접근하기를 원한다.

CloudFront는 가상 프라이빗 클라우드(VPC)가 없기 때문에 CloudFront, 백엔드 애플리케이션 둘달 퍼블릭으로 설정하지 않으면 EC2(백엔드)에 접근 할 수 없다.

따라서 모든 엣지 로케이션의 모든 공용 IP가 EC2에 접근할 수 있도록 설정이 필요하다


두번째 방식으로느는 어플리케이션 로드 밸런서이다

마찬가지로 공용으로 설정되어있어야 한다

반면 EC2의 인스턴스는 프라이빗으로 설정해도 된다. 로드밸런서가 이를 해결해줄것이다

---

## CloudFront 지리적 제한 기능

접근이 가능한 국가 목록을 만들어 설정할 수 있다. 반대도 가능

이런케이스는 저작권법으로 인한 제한 등이 있다

---

## 비용

시험에 나올 수 있다
엣지 로케이션마다 비용이 다르다

비용 절감을 위해 CloudFront를 분살할 엣지 로케이션 수를 줄이는 방법이 있다

Price Class All
- 최고 성능
Price Class 200
- 대부분의 리전은 사용 가능하지만 가장 비싼 리전은 제외
Price class 100
- 가장 저렴한 리전만 사용

---

## 캐시 무효화

TTL(타임 투 리브)를 하루로 설정하면
하루 24시간 안에 엣지 로케이션이 파일을 캐시로 다시 가져온다

더빨리 반영하고싶다면
`index.html`파일과 모든 이미지를에대한 경로 `/images/*` 파일을 무효화 하도록 엣지 로케이션에 지시하면 된다.
그러면 엣지 로케이션은 캐시로부터 파일을 지우고, 사용자가 요청할때 새로 캐싱하게 된다

---

## AWS Global Accelerator

멀리 떨어져있는 지역에서 서버가 있는 리전으로 오기까지 딜레이가 걸릴 수 있다.

이를위해 Global Accelerator를 사용한다

>유니캐스트IP
>하나의 서버가 하나의 IP주소를 가진다

>애니캐스트IP
>모든 서버가 동일한 IP주소를 가지며 클라이언트는 가장 가까운 서버로 라우팅된다

Global Accelerator는 애니캐스트를 사용한다

인도에 서버가 있고 미국에서 접근한다면
엣지 로케이션에 먼저 연결되고, 엣지 로케이션은 안정적이고 지연시간이 적은 사설 AWS네트워크를 거쳐 인도 로드벨런서로 트래픽을 전달한다. 이를 통해 지연시간을 줄일 수 있다

아무것도 캐시하지 않기에 클라이언트 캐시와도 문제가 없다

### 상태 확인

Global Accelerator가 애플리케이션에 대해 상태확인을 실행한다

애플리케이션이 글로벌한지 확인한다

한 리전에 있는 한 ALB에 대해 상태 확인을 실패하면 자동화 된 장애조치가 1분안에 정상 엔드포인트로 실행된다


CloudFront와의 차이

둘 다 동일한 글로벌 네트워크를 사용하고있고,
둘 다 AWS가 생성한 전세계의 엣지 로케이션을 사용한다.
둘 다 DDoS 보호를 위해 AWS Shield와 통합되어있다.

CloudFront는 이미지나 비디오처럼 캐싱 가능한 내용과 API가속 및 동적 사이트 전달 같은 동적 내용 모두에 대해 성능을 향상시킨다.

반면에 Global Accelerator는 TCP나 UDP상의 다양한 애플리케이션 성능을 향상시킨다
그러나 패킷은 엣지 로케이션으로부터 하나 이상의 AWS리전에서 실행되는 애플리케이션으로 프록시된다. 이 경우 모든 요청이 애플리케이션으로 전달된다.
캐싱은 불가능

따라서 게임이나 IoT또는 Voice Over Ip같은 비 HTTP를 사용할 경우 매우 적합하다

글로벌하게 고정 IP를 요구하는 HTTP를 사용할때도 매우 유용하다
