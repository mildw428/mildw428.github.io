---
layout: default
title: 04. EC2 - EBS
parent: aws
---
# 04. EC2 - EBS
---

EBS (Elastic Block Store)
인스턴스가 실행중인 동안 연결 가능한 네트워크 드라이브

인스턴스가 종료된 이후에도 데이터 유지 가능

CCP레벨의 EBS볼륨은 하나의 EBS는 하나의 EC2 인스턴스에만 마운트 가능

또한 EBS 볼륨을 생성할때는 특정 가용 역역에서만 사용 가능
스냅샷을 이용하면 다른 가용 영역으로도 볼륨을 옮길 수 있다

>CCP 레벨 : 하나의 EBS는 하나의 EC2 인스턴스에만 마운트 가능 / 어소시에이트 레벨: 일부 EBS 다중 연결

EBS볼륨은 꼭 인스턴스에 연결되야하지는 않다

기본적으로 인스턴스 종료시 삭제 옵션이 활성화 되어있다.

---

EBS 스냅샷 기능

EBS Snapshot Archive
- 최대75%할인
- 아카이브를 복원하는데 최대 24시간에서 72시간

EBS Bin for EBS Snapshot
- Snapshot을 영구 삭제하는 대신 휴지통에 넣을 수 있다
- 실수로 삭제하는 경우 휴지통에서 복원 가능
- 휴지통 보관 기간은 1일에서 1년 사이

Fas Snapshot Restore
- 스냅샷을 완전 초기화해 첫 사용에서의 지연 시간을 없애는 기능
- 스냅샷의 크기가 크거나 EC2 인스턴스를 빠르게 초기화해야 할 때 유용하다
- 비용이 많이든다

---

AMI (Amazon Machine Image)
- EC2 인스턴스를 통해 만든 이미지 통칭
- A Public AMI : AWS에서 지원
- Your own AMI : 본인이 만든
- An AWS Marketplace AMI : 다른사람이 만든
	- 기업에서 본인의 소프트웨어까지 넣어두고 판매

>설정을 어디까지 따주는거임?

---

EC2 Instance Store

인스턴스를 담고있는 물리적 하드웨어 드라이브

성능은 좋지만  인스턴스를 중지,종료하면 해당 스토리지는 손실된

버퍼, 캐시, 스크래치 데이터 또는 임시 콘텐츠를 사용하려는 경우에 사용

장기적인 스토리지는 EBS가 맞음

EC2 인스턴스 스토리지에 데이터를 저장하려면 날아갈 우려가 있으므로 백업해둬야한다

성능이 아주 뛰어난 하드웨어가 연결된 경우 EC2 인스턴스 스토어를 생각해야한다?

---

EBS 볼륨 유형

총 6가지
- gp2/gp3
	- 범용
- io1/io2
	- 성능좋은
- st1
	- 저비용
	- 잦은 접근과 처리량
- sc1
	- 가장 비용이 적게드는 HDD 볼륨
	- 접근 빈도가 낮은 워크로드를 위해

>IOPS
>초당 I/O 작업 수


EC2에서는 gp2/gp3 io1/io2만이 부팅 볼륨으로 사용될 수 있다.

시험에는 gp2와 IOPS 프로비저닝이 가장 중요하다

gp2는 짧은 지연시간, 시스템 부팅 볼륨, 가상 데스크톱, 개발, 테스트 환경에서 사용할 수 있다

크기는 1GB에서 16TB까지 다양하다

gp2 gp3차이
- gp3
	- 최신 세대의 볼륨
	- 기본 성능으로 3,000 IOPS 초당 125MB
	- IOPS는 16,000 1,000MB 까지 증가시킬 수 있다
- gp2
	- 볼륨이 더 작음
	- IOPS가 볼륨과 연결되어있어 더 큰 볼륨을 사용해야 IOPS를 늘릴 수 있다.

IOPS 성능을 유지할 필요가 있는 주요 어플리케이션이나 데이터베이스에서는 gp2/gp3 또는 io1/io2를 사용하는게 좋다

io1/io2
- 4GB ~ 16TB
- Nitro EC2 인스턴스에서는 최대 64,000 IOPS까지 가능 아닌경우 32,000
- io1/io2 는 gp3와 같이 독자적으로 IOPS를 증가시킬 수 있다
- io1/io2 중 무조껀 io2를 사용하는게 좋다. 동일한 비용으로 내구성과 기기당 IOPS의 수가 더 높다
- io2
	- 지연시간이 밀리세컨 이하
	- IOPS 대 GB 비율이 1,000:1일때 최대 256,000 IOPS

>**프로비저닝이란?**
>프로비저닝은 서버, 애플리케이션, 네트워크 구성, 스토리지, 엣지 기기 등을 배포하는 과정에서 초기 단계에 해당합니다.


st1, sc1
- HDD
- 최대 16TB
	- st1
		- 빅데이터나 데이터 웨어하우징 로그처리에 적합
		- 최대 처리량은 초당 500MB IOPS 최대 500
	- sc1
		- 아카이브 데이터용
		- 집근 빈도가 낮은 데이터에 사용
		- 최저 비용으로 데이터 저장
		- 250MB IOPS 250 

---

다중연결 EBS
- 여러 EC2 인스턴스에 연결
- o1/io2만 사용 가능 
- 각 인스턴스는 고성능 볼륨에 대한 읽기 및 쓰기 권한을 전부 갖는다
- 한 AZ에서 다른 AZ로 EBS 연결은 불가능
- 한번에 16개의 EC2인스턴스만 가능
- 반드시 클러스터 인식 파일 시스템을 사용해야한다
  XFS, EX4와는 다름
  
---

EBS 암호화

암호화는 인스턴스 - 볼륨 전송데이터, 볼륨 ,스냅샷, 스냅샷으로 생성된 볼륨 모두에 동시다발적으로 발생

암호화는 지연시간에는 영향이 거의 없다

KMS를 통한 암호화


암호화 되지 않은 EBS 암호화 하는방법
EBS를 스냅샷 생성시점에 암호화 설정을 한다
암호화 된 스냅샷을 볼륨으로 생성한다
볼륨은 암호화된 스냅샷을 기준으로 했기때문에 자동으로 암호화가 설정되어있다.

---

EFS (Elastic FIle System)

관리형 NFS이다 (네트워크 파일 시스템)

많은 EC2 인스턴스에 마운트 될 수 있다

서로 다른 가용영역도 가능

가용성이 높고 확장성이 뛰어나며 비싸다. gp2 EBS 볼륨의 약 3배

사용량에 따라 비용을 지뷸하므로 용량을 설정할 필요가 없다

사용사례
- 콘텐츠관리
- 웹 서빙
- 데이터 공유
- Wordpress

내부적으로 NFS 프로토콜을 사용하며 EFS에 대한 액세스를 제어하려면 보안 그룹을 성정해야한다

윈도우가 아닌 Linux 기반의 AMI와만 호환된다

>EBS(탄력적 블록 저장소)와 EFS(탄력적 파일 시스템)는 AWS에서 제공하는 스토리지 서비스입니다. EBS는 블록 수준 저장소이고 EFS는 파일 수준 저장소입니다.


- EFS 스케일은 동시에 NFS 클라이언트 수천개와 10GB이상의 처리량
- PB 규모의 네트워크 파일 시스템으로 자동 확장할 수 있다.
- 성능 모드를 설정할 수 있다.
	- 범용 - 지연 시간에 민감한 웹서버나 CMS
	- 최대 I/O - 처치량 최대화 지연시간이 더 긴, 병렬성이 높음, 빅데이터 또는 미디어 처리가 필요한경우
- 처리량 모드
	- busting - 1TB, 초당 50MiB ~ 100MiB 버스트
	- Provisioned - 스토리지 크기 관계없이 처리량을 설정하고싶은경우 1TB, 1GiB를 처리
	- Elastic - 워크로드에 따라 처리량을 자동 조절
	  읽기는 3GiB, 쓰기는 1GiB


Storage Classes
- Storage Tiers
	- 며칠 후 파일을 다른 계층으로 옮길 수 있는 기능
		- 표준 계층은 자주 액세스하는 파일을 위한 계층이다
		- 자주 액세스하지 않는 계층은 EFS-IA인데, 이 계층에서 파일을 검색할 경우 비용이 발생한다.
		- 하지만 EFS-IA에 저장하면 비용이 감소된다.
		- EFS-IA를 사용하려면 수명 주기 정책을 사용해야한다

---
