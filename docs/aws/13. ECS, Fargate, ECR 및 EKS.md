---
layout: default
title: 13. ECS, Fargate, ECR 및 EKS
parent: aws
---
# 13. ECS, Fargate, ECR 및 EKS
---

도커란?
앱 배포를 위한 소프트웨어 개발 플랫폼
컨테이너 기술

온프레미스에서 클라우드로 앱을 리프트-앤-시프트

도커와 가상 머신의 차이점
도커는 순전히 가상화 기술은 아니다
리소스가 호스트와 공유되어 한 서버에서 다수의 컨테이너를 공유할 수 있다

가상 머신의 아키텍처를 살펴보면 인프라와 호스트 운영체제가 있으며 그 위에 하이퍼바이저가 있고 앱과 guest운영체제가 있다

반면 도커 컨테이너의 경우 인프라와 ec2인스턴스 같은 호스트 os가 있고 도커 Daemon위에 많은 컨테이너가 있다

가상머신보다 덜 안전하지만 하나의 서버에 많은 컨테이너를 실행할 수 있다

AWS에서 도커 컨테이너를 관리하는 방법은 ECS이다 (Elastic Container Service)

---

## ECS

aws에서 컨테이너를 실행하면
ecs클러스터에서 ecs테스크를 실핸하는것이다

ecs클러스터에는 ec2 인스턴스가 들어있다

즉 ecs 클러스터는 여러 ec2 인스턴스로 구성된다는 뜻

ecs클러스터는 ec2내부의 ecs agent를 실행한다
그럼 ecs 에이전트가 각각의 ec2인스턴스를 amazon ecs 서비스와 지정된 ecs클러스터에 등록한다

이후에 ecs 테스크를 수행하기 시작하면 aws가 컨테이너를 시작하거나 멈춘다

도커 컨테이너는 미리 프로저닝한 ec2 인스턴스에 위치한다



### Fargate

마찬가지로 aws에 도커 컨테이너를 실행하는데,

이번에는 인프라를 프로비저닝 하지 않아 관리할 ec2인스턴스가 없다

서버리스이다

서버를 관리하지 않아 서버리스라고 부르는데 서버가 없는건 아니ㄷ

필요한 cpu나 ram에 따라 ecs테스크를 aws가 대신 실행한다

관리가 필요 없다

---

ecs 테스크의 iam 역할

ec2인스턴스 프로파일 역할과 ecs테스크 역할의 차이점 기억

???

---

ecs를 사용할때 ec2와 fargate 모두 사용한다면 efs를 사용해서 데이터를 공유하는게 좋다

s3는 ecs테스크에 파일 시스템으로 마운트 될 수 없다

---

## 오토스케일링

aws Auto Scaling 서비스가 있다

CPU, RAM, ALB의 타겟당 요청수
위 세개의 지표에 대해 사용률을 확장할 수 있다


특정 타겟을 추적하는 대상 추척 스케일링이나
단계 스케일링
혹은 미리 ECS서비스 확장을 설정하는 예약 스케일링이 있다

EC2 시작 유형이라면
태스크 레벨에서의 ECS 서비스 확장이 EC2 인스턴스 클러스터의 확장과 다르다는것 인지 필요
-> ECS클러스터 용량 공급자
새 테스크를 실행할 용량이 부족하면 자동으로 ASG를 확장한다

---

## ECR
Elastic Container Registry

aws에 도커 이미지를 저장하고 관리하는데 사용한다

Docker Hub등의 온라인 저장소를 사용해도되지만, amazon ecr에도 저장할 수 있다

옵션
계정에 한해 이미지를 비공개로 저장

혹은 퍼블릭 저장소를 사용해 Amazon ECR Public Gallery에 게시


---

## EKS
Elastic Kubernetes Service

관리형 Kubernetes 클러스터를 실행할 수 있는 서비스

Docker로 컨테이너화한 애플리케이션의 자동 배포, 확장, 관리를 지원한다

컨테이너를 실행한다는 목적은 ECS와 비슷하지만 사용하는 API가 다르다

ECS는 오픈소스가 아닌 반면 Kubernetes는 오픈소스이고 여러 클라우드 제공자가 사용함로 표준화를 기대할 수 있다

EKS에는 두가지 실행 모드가 있다

EC2 시작 모드는 ec2 인스턴스에서 처럼 작업자 모드를 배포할 때 사용하고,

Fargate모드는 EKS클러스터에 서버리스 컨테이너를 배포할 때 사용한다

EKS클러스터에 데이터 볼륨을 연결하려면 EKS 클러스터에 스토리지 클래스 매니페스트를 지정해야한다

---

## App Runner

완전 관리형 서버스로 규모에 따라 웹 애플리케이션, api 배포를 돕는다

인프라나 컨테이너 소스 코드 등을 알 피룡가 전혀 없다

먼저 소스코드나 docker컨테이너 이미지를 가지고 원하는 구성을 설정한다

cpu의 수나 컨테이너 메모리의 크기 오토스케일링 여부 상태 확인을 설정하면 된다

다음 작업은 자동으로 이뤄진다

app runner서비스가 웹 앱을 빌드하고 배포한다 컨테이너가 생성되고 배포된다

api나 웹 앱이 배포된 다음엔 url을 통해 바로 액세스할 수 있다

장점
오토 스케일링이 가능하고 가용성이 높으며 로드 밸런싱 및 암호화 기능을 지원한다

컨테이너가 vpc에 애세스할 수 있어서 데이터베이스와 캐시 메시지 대기열 서비스에 연결할 수 있다

사용 사례로는 빨리 배포해야하는 웹 앱 api 그리고 마이크로 서비스가 있다



