---
layout: default
title: 엑셀 데이터 업로드 성능 개선
parent: memo
---
# 엑셀 데이터 업로드 성능 개선
---

- **상황**
    - 인사평가 시스템에서 엑셀 업로드를 통해 진단자-대상자 지정 기능을 제공 중.
    - 기존에는 단일 등록 로직을 그대로 재활용하여 성능 저하 문제가 발생했으며, 대량 데이터 처리 시 connection timeout이 빈번히 발생함.
    - IDENTITY 전략을 사용한 JPA로 인해 id 생성 과정에서 병목이 발생함.
- **과제**
    - 기존 단일 등록 로직을 최대한 유지하되, 성능을 개선하여 대량 데이터 처리에 적합하도록 수정이 필요.
    - IDENTITY 전략의 병목을 해소하고, 대량 데이터를 한 번에 insert할 수 있도록 쿼리 최적화가 요구됨.
    - AWS API Gateway에서 30초 내에 응답을 받지 못하는 경우 connection timeout이 발생하는 제한이 있어, 이를 고려한 비동기 처리 방식 도입 필요.
- **해결**
    - 기존 로직을 유지하면서 성능을 개선하기 위해 read-only 처리를 적용하여 더티체킹을 최소화. 엔티티의 id 값 여부로 새 객체를 구분해 저장하는 로직을 사용.
    - 대량 insert 처리를 위해 JPA 대신 `jdbcTemplate`을 사용하여 batch insert 구현.
        - 단, `jdbcTemplate`으로 저장 시 애플리케이션에서는 DB에 생성된 id 값을 알 수 없는 문제가 발생. 이를 해결하기 위해 객체의 특정 컬럼을 조합하여 고유 값을 조회하고, 이를 통해 id 값을 도출.
        - 도출한 id 값을 하위 자식 엔티티에게 전달하여 일관성 유지.
    - API Gateway의 30초 timeout 문제를 해결하기 위해 Kafka를 사용한 비동기 처리 도입.
        - 엑셀 파일 업로드 요청 시, 파일을 서버에 저장한 뒤 Kafka 메시지를 발행.
        - 어플리케이션은 해당 메시지를 컨슘하여 비동기적으로 처리 로직을 수행하고, 업로드 상태를 클라이언트에서 주기적으로 확인할 수 있도록 구현.
- **결과**
    - 엑셀 업로드 속도가 기존 대비 7배 개선되었으며, connection timeout 문제 없이 안정적으로 대량 데이터 처리가 가능해짐.
    - 비동기 처리 도입으로 클라이언트는 업로드 상태를 실시간으로 모니터링 가능해져 사용자 경험이 향상됨.
